// If we're the child, hook up our end of the protocol.
if (process.env.NODE_SLAVE_SCRIPT) {
	var Remote = require('remoteagent-protocol').Remote;
  	var remote = new Remote(process.stdin, process.stdin, 1);
  	var path = require('path');

	remote.on('error', function (err) { process.emit('error', err); });
	remote.on('message', function (message) {
		process.emit('message', message);
	});
	process.send = function (message) {
		remote.emitRemote("message", message);
	};
	var scriptPath = path.resolve(process.env.NODE_SLAVE_SCRIPT);
	require(scriptPath);
	process.stdin.resume();
}
else {
	console.error("This is meant to be run by the slavedriver");
}